version: '3'

services:
  nginx:
    image: nginx:latest
    container_name: "{{PROJECT_NAME}}-nginx"
    ports:
      - "8{{PROJECT_NUMBER}}:8080"
    volumes:
      - {{PROJECT_FOLDER}}:/usr/share/nginx/html
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
    working_dir: "/usr/share/nginx/html"
    expose:
      - 8{{PROJECT_NUMBER}}
    environment:
      VIRTUAL_PORT: 8{{PROJECT_NUMBER}}
      VIRTUAL_HOST: etopia.pl
  php:
    image: fr4gm3nt/mocker:php{{PHP_VERSION}}
    container_name: "{{PROJECT_NAME}}-php"
    volumes:
      - {{PROJECT_FOLDER}}:/usr/share/nginx/html
      - ./php/bashrc:/root/.bashrc
      - ./php/php.ini:/usr/local/etc/php/conf.d/php-override.ini
      - ./db:/var/www/db
      - "${SSH_AUTH_SOCK}:/ssh-agent"
      - ./php/bin/mhsendmail:/usr/local/bin/mhsendmail
    environment:
      - SSH_AUTH_SOCK=/ssh-agent
    working_dir: "/usr/share/nginx/html"
    ports:
      - "9{{PROJECT_NUMBER}}:9000"

networks:
  default:
    external:
      name: nginx-proxy